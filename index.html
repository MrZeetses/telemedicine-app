<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TeleMed 103.kz ‚Äî –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –æ–Ω–ª–∞–π–Ω-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è–º–∏</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://meet.jit.si/external_api.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #2563eb; --success: #10b981; --danger: #ef4444; }
        body { font-family: 'Manrope', sans-serif; scroll-behavior: smooth; }
        .tab-active { border-bottom: 3px solid var(--primary); color: var(--primary); }
        .custom-loader { border: 3px solid #f3f3f3; border-top: 3px solid var(--primary); border-radius: 50%; width: 20px; height: 20px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .hidden-section { display: none !important; }
        /* –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –¥–∏–∑–∞–π–Ω—É –∏–∑ –®–∞–≥–∞ 3 */
        .video-overlay { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(8px); }
    </style>
</head>
<body class="bg-slate-50 text-slate-900">

    <div id="toast-container" class="fixed top-5 right-5 z-[9999] flex flex-col gap-3"></div>

    <div id="browser-warning" class="hidden-section fixed inset-0 z-[9000] bg-white p-10 flex flex-col items-center justify-center text-center">
        <div class="max-w-md">
            <h2 class="text-3xl font-extrabold text-slate-800 mb-4">–ë—Ä–∞—É–∑–µ—Ä –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è</h2>
            <p id="browser-msg" class="text-slate-500 mb-8"></p>
            <a href="https://www.google.com/chrome/" target="_blank" class="bg-blue-600 text-white px-8 py-4 rounded-2xl font-bold shadow-xl">–°–∫–∞—á–∞—Ç—å Chrome</a>
        </div>
    </div>

    <div id="auth-screen" class="min-h-screen flex flex-col items-center justify-center bg-slate-100 p-4">
        <div class="w-full max-w-lg bg-white rounded-[2.5rem] shadow-2xl p-10 border border-slate-200">
            <div class="flex flex-col items-center mb-10">
                <div class="w-16 h-16 bg-blue-600 rounded-2xl flex items-center justify-center text-white text-3xl font-black mb-4">103</div>
                <h2 id="auth-title" class="text-3xl font-extrabold tracking-tight">–í—Ö–æ–¥ –≤ –∫–∞–±–∏–Ω–µ—Ç</h2>
                <p class="text-slate-400 text-sm mt-2">–ú–æ–¥—É–ª—å —Ç–µ–ª–µ–º–µ–¥–∏—Ü–∏–Ω—ã –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤</p>
            </div>

            <div id="auth-form" class="space-y-6">
                <div id="reg-fields" class="hidden-section space-y-6 animate-in fade-in duration-500">
                    <div class="relative">
                        <label class="text-[11px] font-bold text-slate-400 uppercase absolute -top-2 left-4 bg-white px-2">–§–ò–û –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞</label>
                        <input type="text" id="full_name" placeholder="–í–≤–µ–¥–∏—Ç–µ –∏–º—è" class="w-full p-5 border-2 border-slate-100 rounded-2xl outline-none focus:border-blue-500 transition-all">
                    </div>
                    <div>
                        <label class="text-[11px] font-bold text-slate-400 uppercase block mb-3 ml-2">–í–∞—à–∞ —Ä–æ–ª—å –≤ —Å–∏—Å—Ç–µ–º–µ</label>
                        <div class="grid grid-cols-2 gap-4">
                            <label class="flex items-center gap-3 p-4 border rounded-2xl cursor-pointer hover:bg-slate-50">
                                <input type="radio" name="user_role" value="admin" checked class="w-5 h-5">
                                <span class="font-bold text-sm">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                            </label>
                            <label class="flex items-center gap-3 p-4 border rounded-2xl cursor-pointer hover:bg-slate-50">
                                <input type="radio" name="user_role" value="doctor" class="w-5 h-5">
                                <span class="font-bold text-sm">–í—Ä–∞—á</span>
                            </label>
                        </div>
                    </div>
                </div>

                <div class="relative">
                    <label class="text-[11px] font-bold text-slate-400 uppercase absolute -top-2 left-4 bg-white px-2">E-mail –∞–¥—Ä–µ—Å</label>
                    <input type="email" id="email" placeholder="email@company.kz" class="w-full p-5 border-2 border-slate-100 rounded-2xl outline-none focus:border-blue-500 transition-all">
                </div>
                <div class="relative">
                    <label class="text-[11px] font-bold text-slate-400 uppercase absolute -top-2 left-4 bg-white px-2">–ü–∞—Ä–æ–ª—å</label>
                    <input type="password" id="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" class="w-full p-5 border-2 border-slate-100 rounded-2xl outline-none focus:border-blue-500 transition-all">
                    <button onclick="resetPassword()" class="absolute right-4 top-5 text-blue-600 text-xs font-bold hover:underline">–ó–∞–±—ã–ª–∏?</button>
                </div>

                <button id="auth-btn" class="w-full py-5 bg-blue-600 text-white rounded-2xl font-black text-lg shadow-xl shadow-blue-200 hover:bg-blue-700 active:scale-95 transition-all">
                    –í–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É
                </button>

                <div class="flex items-center justify-center gap-2 pt-4">
                    <span class="text-sm text-slate-400" id="toggle-text">–í–ø–µ—Ä–≤—ã–µ –≤ —Å–∏—Å—Ç–µ–º–µ?</span>
                    <button onclick="toggleAuth()" id="toggle-btn" class="text-blue-600 font-bold text-sm hover:underline tracking-tight">–°–æ–∑–¥–∞—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
                </div>
            </div>
        </div>
    </div>

    <div id="main-dashboard" class="hidden-section min-h-screen flex flex-col">
        <header class="bg-white border-b border-slate-200 px-8 py-5 flex justify-between items-center sticky top-0 z-50">
            <div class="flex items-center gap-10">
                <div class="flex items-center gap-3">
                    <div class="bg-blue-600 text-white p-2 rounded-lg font-black text-sm">103.kz</div>
                    <span class="font-extrabold text-xl tracking-tighter">TeleMed Portal</span>
                </div>
                <nav class="hidden md:flex items-center gap-8">
                    <button onclick="switchTab('consultations')" class="nav-tab tab-active text-sm font-bold pb-1">–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏</button>
                    <button onclick="switchTab('templates')" class="nav-tab text-sm font-bold text-slate-400 pb-1">–®–∞–±–ª–æ–Ω—ã SMS</button>
                    <button onclick="switchTab('payments')" class="nav-tab text-sm font-bold text-slate-400 pb-1">–û–ø–ª–∞—Ç—ã</button>
                    <button onclick="switchTab('settings')" class="nav-tab text-sm font-bold text-slate-400 pb-1">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                </nav>
            </div>
            <div class="flex items-center gap-6">
                <div class="text-right flex flex-col">
                    <span id="user-name-top" class="font-bold text-sm text-slate-800 tracking-tight"></span>
                    <span class="text-[10px] text-slate-400 font-black uppercase tracking-widest">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                </div>
                <button onclick="logout()" class="w-10 h-10 bg-slate-50 rounded-full flex items-center justify-center text-slate-400 hover:text-red-500 transition-colors">üö™</button>
            </div>
        </header>

        <main class="flex-1 p-8 grid grid-cols-12 gap-8 max-w-[1600px] mx-auto w-full">
            
            <div id="left-sidebar" class="col-span-12 lg:col-span-4 flex flex-col gap-8">
                
                <div id="create-panel" class="bg-white p-8 rounded-[2rem] shadow-sm border border-slate-200">
                    <h3 class="text-xl font-extrabold mb-6 flex items-center gap-3">
                        <span class="w-8 h-8 bg-green-50 text-green-600 rounded-lg flex items-center justify-center text-sm">‚úö</span>
                        –ù–∞–∑–Ω–∞—á–∏—Ç—å –ø—Ä–∏–µ–º
                    </h3>
                    <div class="space-y-4">
                        <div class="relative">
                            <label class="text-[10px] font-black text-slate-400 uppercase mb-2 block ml-1">–õ–µ—á–∞—â–∏–π –≤—Ä–∞—á</label>
                            <input type="text" id="input-doc" placeholder="–ü–æ–∏—Å–∫ –≤—Ä–∞—á–∞..." class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none transition-all text-sm">
                            <div id="doc-autocomplete" class="absolute top-full left-0 w-full bg-white shadow-xl rounded-xl z-20 mt-1 max-h-40 overflow-y-auto hidden"></div>
                        </div>
                        <div class="relative">
                            <label class="text-[10px] font-black text-slate-400 uppercase mb-2 block ml-1">–ü–∞—Ü–∏–µ–Ω—Ç</label>
                            <input type="text" id="input-pat" placeholder="–§–ò–û –ø–∞—Ü–∏–µ–Ω—Ç–∞" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl focus:ring-2 focus:ring-blue-500 outline-none transition-all text-sm">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="text-[10px] font-black text-slate-400 uppercase mb-2 block ml-1">–î–∞—Ç–∞</label>
                                <input type="date" id="input-date" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl text-sm outline-none">
                            </div>
                            <div>
                                <label class="text-[10px] font-black text-slate-400 uppercase mb-2 block ml-1">–í—Ä–µ–º—è</label>
                                <input type="time" id="input-time" class="w-full p-4 bg-slate-50 border border-slate-200 rounded-2xl text-sm outline-none">
                            </div>
                        </div>
                        <button onclick="handleCreateAppointment()" class="w-full py-4 bg-[#10b981] text-white rounded-2xl font-black shadow-lg shadow-green-100 hover:bg-[#059669] transition-all flex items-center justify-center gap-2">
                            <span>–°–æ–∑–¥–∞—Ç—å –∏ –ø–æ–ª—É—á–∏—Ç—å —Å—Å—ã–ª–∫–∏</span>
                        </button>
                    </div>
                </div>

                <div class="bg-white rounded-[2rem] shadow-sm border border-slate-200 flex flex-col flex-1 min-h-[500px]">
                    <div class="p-6 border-b border-slate-100 flex items-center justify-between">
                        <h3 class="font-black text-slate-800">–°–ø–∏—Å–æ–∫ —Å–µ—Å—Å–∏–π</h3>
                        <span id="app-count" class="bg-slate-100 text-slate-500 px-3 py-1 rounded-full text-[10px] font-black">0</span>
                    </div>
                    <div class="p-4 bg-slate-50 border-b border-slate-100">
                        <input type="text" id="search-input" oninput="filterAppointments()" placeholder="üîç –ü–æ–∏—Å–∫ –ø–æ –§–ò–û –≤—Ä–∞—á–∞ –∏–ª–∏ –ø–∞—Ü–∏–µ–Ω—Ç–∞..." class="w-full p-3 border border-slate-200 rounded-xl text-xs outline-none focus:ring-1 focus:ring-blue-400">
                    </div>
                    <div id="appointment-list" class="flex-1 overflow-y-auto custom-scrollbar p-4 space-y-4">
                        </div>
                    <button onclick="toggleCompleted()" class="p-4 bg-slate-50 border-t border-slate-100 text-xs font-bold text-slate-400 hover:text-slate-600">
                        –ü–æ–∫–∞–∑–∞—Ç—å/–°–∫—Ä—ã—Ç—å –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏
                    </button>
                </div>
            </div>

            <div id="right-content" class="col-span-12 lg:col-span-8 space-y-8">
                
                <div class="relative group">
                    <div id="video-root" class="bg-slate-900 rounded-[2.5rem] shadow-2xl aspect-video border-[10px] border-white overflow-hidden relative">
                        <div id="call-wait-screen" class="absolute inset-0 flex flex-col items-center justify-center text-center p-10 video-overlay text-white z-10">
                            <div class="w-24 h-24 bg-blue-600/20 rounded-full flex items-center justify-center mb-6 border-2 border-blue-500/30">
                                <span class="text-5xl animate-bounce">üì±</span>
                            </div>
                            <h2 class="text-3xl font-black mb-4">–û–∂–∏–¥–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</h2>
                            <p class="text-slate-400 max-w-sm">–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é –∏–∑ —Å–ø–∏—Å–∫–∞ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è –¥–æ –Ω–∞—á–∞–ª–∞ –ø—Ä–∏–µ–º–∞.</p>
                            <div class="mt-8 flex gap-4">
                                <div class="px-6 py-3 bg-white/10 rounded-2xl border border-white/10 flex items-center gap-3">
                                    <span class="w-3 h-3 bg-green-500 rounded-full animate-ping"></span>
                                    <span class="text-xs font-bold uppercase tracking-widest">–ö–∞–º–µ—Ä–∞ –≥–æ—Ç–æ–≤–∞</span>
                                </div>
                            </div>
                        </div>
                        <div id="jitsi-container" class="hidden-section w-full h-full"></div>
                    </div>
                </div>

                <div id="app-details-box" class="hidden-section animate-in slide-in-from-bottom-5 duration-500">
                    <div class="bg-white p-10 rounded-[2.5rem] shadow-sm border border-slate-200">
                        <div class="flex flex-col md:flex-row justify-between gap-8 mb-10 pb-10 border-b border-slate-100">
                            <div class="space-y-2">
                                <div id="detail-status-pill" class="inline-block px-4 py-1.5 rounded-full text-[10px] font-black uppercase tracking-widest mb-2"></div>
                                <h4 id="detail-doc" class="text-3xl font-black text-slate-800 leading-none"></h4>
                                <p id="detail-pat" class="text-blue-600 font-extrabold text-lg italic"></p>
                            </div>
                            <div class="flex flex-col md:items-end justify-center">
                                <p id="detail-date" class="text-2xl font-black text-slate-800"></p>
                                <p id="detail-time-left" class="text-xs font-bold text-slate-400 uppercase tracking-widest mt-1"></p>
                            </div>
                        </div>

                        <div class="grid md:grid-cols-2 gap-8">
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <span class="text-xs font-black text-slate-400 uppercase tracking-widest">–î–ª—è –¥–æ–∫—Ç–æ—Ä–∞</span>
                                    <div class="flex gap-2">
                                        <button onclick="copyToClipboard('doc-link')" class="text-[10px] bg-slate-100 px-3 py-1 rounded-full font-bold hover:bg-slate-200 transition">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                                        <button onclick="sendSMS('doc')" class="text-[10px] bg-blue-50 text-blue-600 px-3 py-1 rounded-full font-bold hover:bg-blue-100 transition">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –°–ú–°</button>
                                    </div>
                                </div>
                                <div class="p-5 bg-slate-50 rounded-2xl border border-slate-200 overflow-hidden">
                                    <p id="doc-link" class="text-xs text-slate-500 font-medium break-all"></p>
                                </div>
                            </div>
                            <div class="space-y-4">
                                <div class="flex items-center justify-between">
                                    <span class="text-xs font-black text-slate-400 uppercase tracking-widest">–î–ª—è –ø–∞—Ü–∏–µ–Ω—Ç–∞</span>
                                    <div class="flex gap-2">
                                        <button onclick="copyToClipboard('pat-link')" class="text-[10px] bg-slate-100 px-3 py-1 rounded-full font-bold hover:bg-slate-200 transition">–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
                                        <button onclick="sendSMS('pat')" class="text-[10px] bg-blue-50 text-blue-600 px-3 py-1 rounded-full font-bold hover:bg-blue-100 transition">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –°–ú–°</button>
                                    </div>
                                </div>
                                <div class="p-5 bg-slate-50 rounded-2xl border border-slate-200 overflow-hidden">
                                    <p id="pat-link" class="text-xs text-slate-500 font-medium break-all"></p>
                                </div>
                            </div>
                        </div>

                        <div class="mt-10 pt-8 border-t border-slate-100 flex flex-wrap gap-4 items-center">
                            <button onclick="confirmAction('cancel')" class="px-8 py-4 bg-red-50 text-red-600 rounded-2xl font-black text-sm hover:bg-red-100 transition flex items-center gap-3">
                                <span>–û—Ç–º–µ–Ω–∏—Ç—å –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é</span>
                            </button>
                            <button onclick="confirmAction('delete')" class="px-8 py-4 bg-slate-50 text-slate-400 rounded-2xl font-black text-sm hover:bg-slate-100 transition">
                                –£–¥–∞–ª–∏—Ç—å –∑–∞–ø–∏—Å—å
                            </button>
                            <div class="ml-auto text-[10px] text-slate-400 italic">
                                * –°—Å—ã–ª–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Ç–µ—á–µ–Ω–∏–µ 3-—Ö —á–∞—Å–æ–≤ –æ—Ç –Ω–∞—á–∞–ª–∞
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="modal-bg" class="hidden-section fixed inset-0 z-[100] bg-slate-900/60 backdrop-blur-sm flex items-center justify-center p-6">
        <div id="modal-content" class="bg-white rounded-[3rem] p-12 max-w-lg w-full shadow-2xl relative overflow-hidden animate-in zoom-in-95 duration-300">
            </div>
    </div>

    <div id="templates-section" class="hidden-section p-10 max-w-6xl mx-auto">
        <h2 class="text-3xl font-black mb-10">–®–∞–±–ª–æ–Ω—ã SMS —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π</h2>
        <div class="grid md:grid-cols-2 gap-8">
            <div class="p-8 bg-white rounded-3xl border border-slate-200 space-y-4">
                <h5 class="font-black text-blue-600 uppercase text-xs tracking-widest">–ù–æ–≤–∞—è –∑–∞–ø–∏—Å—å (–í—Ä–∞—á)</h5>
                <p class="text-slate-600 italic">"–£ –≤–∞—Å –Ω–æ–≤–∞—è –∑–∞–ø–∏—Å—å –Ω–∞ –æ–Ω–ª–∞–π–Ω-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—é {—Å—Å—ã–ª–∫–∞}"</p>
            </div>
            <div class="p-8 bg-white rounded-3xl border border-slate-200 space-y-4">
                <h5 class="font-black text-blue-600 uppercase text-xs tracking-widest">–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ (–ü–∞—Ü–∏–µ–Ω—Ç)</h5>
                <p class="text-slate-600 italic">"–û–Ω–ª–∞–π–Ω-–∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è —Å–µ–≥–æ–¥–Ω—è –≤ 15:00 {—Å—Å—ã–ª–∫–∞}"</p>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>